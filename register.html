<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>р╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╣Ар╕Ир╣Йр╕▓р╕лр╕Щр╣Йр╕▓р╕Чр╕╡р╣И - IT Udon Hospital</title>
    <link rel="stylesheet" href="style.css?v=4.0">
</head>
<body>

    <div id="loader" class="loader-overlay"><div class="spinner"></div></div>

    <div class="login-wrapper">
        <div class="login-header">
            <img src="https://img2.pic.in.th/-227e4f6f84f29f020.png" class="header-logo">
            <div class="header-text">
                <h1>р╣Вр╕гр╕Зр╕Юр╕вр╕▓р╕Ър╕▓р╕ер╕нр╕╕р╕Фр╕гр╕Шр╕▓р╕Щр╕╡</h1>
                <p>ЁЯУз р╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╣Бр╕ер╕░р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Ьр╣Ир╕▓р╕Щр╕нр╕╡р╣Ар╕бр╕е</p>
            </div>
        </div>

        <div class="login-card" id="regForm">
            <h2 style="color:var(--primary-pink); margin-bottom: 25px;">ЁЯЦЛя╕П р╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щр╕кр╕бр╕▓р╕Кр╕┤р╕Б</h2>
            <div class="form-group">
                <label>ЁЯЖФ Username</label>
                <input type="text" id="reg_username" placeholder="р╣Др╕нр╕Фр╕╡р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ">
            </div>
            <div class="form-group">
                <label>ЁЯУз Email (р╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕▒р╕Ър╕гр╕лр╕▒р╕кр╕вр╕╖р╕Щр╕вр╕▒р╕Щ)</label>
                <input type="email" id="reg_email" placeholder="р╕Хр╣Йр╕нр╕Зр╣Ар╕Ыр╣Зр╕Щр╣Ар╕бр╕ер╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╕Ир╕гр╕┤р╕З">
            </div>
            <div class="form-group">
                <label>ЁЯСд р╕Кр╕╖р╣Ир╕н-р╕Щр╕▓р╕бр╕кр╕Бр╕╕р╕е</label>
                <input type="text" id="reg_name" placeholder="р╕Кр╕╖р╣Ир╕нр╕Ир╕гр╕┤р╕З-р╕Щр╕▓р╕бр╕кр╕Бр╕╕р╕е">
            </div>
            <div class="form-group">
                <label>ЁЯФР р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ</label>
                <input type="password" id="reg_password" placeholder="р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ 6 р╕Хр╕▒р╕зр╕Вр╕╢р╣Йр╕Щр╣Др╕Ы">
            </div>
            <div class="form-group">
                <label>ЁЯПв р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕З</label>
                <select id="reg_position">
                    <option value="">-- р╣Ар╕ер╕╖р╕нр╕Бр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕З --</option>
                    <option value="р╕лр╕▒р╕зр╕лр╕Щр╣Йр╕▓р╕Зр╕▓р╕Щ IT">ЁЯТ╝ р╕лр╕▒р╕зр╕лр╕Щр╣Йр╕▓р╕Зр╕▓р╕Щ IT</option>
                    <option value="р╕Щр╕▒р╕Бр╕зр╕┤р╕Кр╕▓р╕Бр╕▓р╕гр╕Др╕нр╕бр╕Юр╕┤р╕зр╣Ар╕Хр╕нр╕гр╣М">ЁЯТ╗ р╕Щр╕▒р╕Бр╕зр╕┤р╕Кр╕▓р╕Бр╕▓р╕гр╕Др╕нр╕бр╕Юр╕┤р╕зр╣Ар╕Хр╕нр╕гр╣М</option>
                    <option value="р╕Кр╣Ир╕▓р╕Зр╣Ар╕Чр╕Др╕Щр╕┤р╕Др╕Др╕нр╕бр╕Юр╕┤р╕зр╣Ар╕Хр╕нр╕гр╣М">ЁЯФз р╕Кр╣Ир╕▓р╕Зр╣Ар╕Чр╕Др╕Щр╕┤р╕Др╕Др╕нр╕бр╕Юр╕┤р╕зр╣Ар╕Хр╕нр╕гр╣М</option>
                </select>
            </div>
            <button onclick="sendOTP()" class="btn-login" id="btnSend">ЁЯУй р╕кр╣Ир╕Зр╕гр╕лр╕▒р╕кр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╣Др╕Ыр╕Чр╕╡р╣Ир╣Ар╕бр╕е</button>
            <button type="button" onclick="window.location.replace('login.html')" class="btn-back">тмЕя╕П р╕Бр╕ер╕▒р╕Ър╕лр╕Щр╣Йр╕▓р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ</button>
        </div>

        <div class="login-card" id="otpForm" style="display: none;">
            <h2 style="color:var(--primary-pink); margin-bottom: 20px;">ЁЯФР р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ</h2>
            <p style="font-size: 0.9rem; margin-bottom: 20px; color: #666;">р╣Ар╕гр╕▓р╣Др╕Фр╣Йр╕кр╣Ир╕Зр╕гр╕лр╕▒р╕к 6 р╕лр╕ер╕▒р╕Бр╣Др╕Ыр╕Чр╕╡р╣И <br><b id="displayEmail"></b></p>
            <div class="form-group">
                <input type="text" id="input_otp" placeholder="р╕Бр╕гр╕нр╕Бр╕гр╕лр╕▒р╕к 6 р╕лр╕ер╕▒р╕Б" style="text-align: center; font-size: 1.5rem; letter-spacing: 5px;">
            </div>
            <button onclick="verifyAndRegister()" class="btn-login">тЬЕ р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╣Бр╕ер╕░р╕ер╕Зр╕Чр╕░р╣Ар╕Ър╕╡р╕вр╕Щ</button>
            <button type="button" onclick="location.reload()" class="btn-back">ЁЯФД р╣Бр╕Бр╣Йр╣Др╕Вр╕Вр╣Йр╕нр╕бр╕╣р╕е/р╕кр╣Ир╕Зр╣Гр╕лр╕бр╣И</button>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        let generatedOTP = ""; 

        async function sendOTP() {
            const email = document.getElementById('reg_email').value;
            if(!email.includes('@')) return alert("тЪая╕П р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕нр╕╡р╣Ар╕бр╕ер╣Гр╕лр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З");

            document.getElementById('loader').style.display = 'flex';
            try {
                // р╕кр╕▒р╣Ир╕Зр╣Гр╕лр╣Й Server р╕кр╣Ир╕Зр╣Ар╕бр╕е
                const res = await apiRequest({ action: 'sendOTP', email: email }, 'POST');
                if (res.success) {
                    generatedOTP = res.otp; // р╕гр╕▒р╕Ъ OTP (р╕Кр╕▒р╣Ир╕зр╕Др╕гр╕▓р╕з) р╕бр╕▓р╣Ар╕Чр╕╡р╕вр╕Ъ р╕лр╕гр╕╖р╕нр╣Гр╕лр╣Й Server р╣Ар╕Кр╣Зр╕Др╕Бр╣Зр╣Др╕Фр╣Й
                    document.getElementById('displayEmail').innerText = email;
                    document.getElementById('regForm').style.display = 'none';
                    document.getElementById('otpForm').style.display = 'block';
                }
            } catch (e) { alert("тЭМ р╕кр╣Ир╕Зр╣Ар╕бр╕ер╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И"); }
            finally { document.getElementById('loader').style.display = 'none'; }
        }

        async function verifyAndRegister() {
            const inputOtp = document.getElementById('input_otp
